<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Postgresqlç¬”è®°01åŸºæœ¬æ“ä½œ</title>
  <meta name="description" content="ä¸»è¦ç›®æ ‡ç†Ÿæ‚‰å’Œç†è§£SQLçš„åŸºæœ¬æ“ä½œã€‚åŸºæœ¬åŠŸèƒ½å’Œé€»è¾‘ã€‚è¿™éƒ¨åˆ†å’Œå…¶ä»–æ•°æ®åº“å…±é€šã€‚å±äºæ ‡å‡†SQLèŒƒå›´ã€‚å­¦ä¹ èµ„æ–™èµ„æ–™è§†é¢‘å®æˆ˜ç¬”è®°å¦‚ä¸‹ï¼Œè‡ªæˆ‘éªŒè¯çš„ç¬”è®°ã€‚ä¸€ã€å¼€å§‹å®‰è£…https://www.postgresql.org/download/å®‰è£…æŒ‡å®šç‰ˆæœ¬Ubuntusudo apt install postgresql-9.6å®‰...">
  <!-- evil icon -->

  <link rel="stylesheet" href="/assets/evil-icons.min.css">
  <script src="/assets/evil-icons.min.js"></script>

  <!-- todo: include this into main.css -->

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://mark24code.github.io/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/postgresql/%E6%95%B0%E6%8D%AE%E5%BA%93/2021/06/29/Postgresql%E7%AC%94%E8%AE%B0.html">
  <link rel="alternate" type="application/rss+xml" title="Mark24" href="https://mark24code.github.io/feed.xml">

  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5H3S9CQNF0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5H3S9CQNF0');
</script>


</head>

  <body>
    <div class="page-content">
      <div class="container">
        <div class="three columns">
          <header class="site-header">

  <h2 class="logo"><a href="/">Mark24</a></h2>
  <div class="description">è®°å½•çµæ„Ÿã€æŠ€æœ¯ã€æ€è€ƒ</div>

  <div class="nav">
    
    <label for="menu-toggle" class="menu-icon">
        <!--div data-icon="ei-navicon"></div-->
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
    </label>
    <input type="checkbox" id="menu-toggle">

    <div class="site-nav">
      <nav>
        <ul class="page-link">
          <li><a href="/">Home</a></li>
          <li><a href="/posts">Posts</a></li>
          <li><a href="/art">Art</a></li>
          <li><a href="https://speakerdeck.com/mark24code">Sliders</a></li>
          <li><a href="/sites">Sites</a></li>
          <li><a href="/feed.xml">RSS</a></li>
          <li><a href="/about">About</a></li>
        </ul>
      </nav>
    </div>

    <section class="small-font">
      
      <a href="https://github.com/Mark24Code"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span></a>

      
      
    </section>
  </div>
</header>

        </div>

        <div class="nine columns" style="z-index:100;">
          <div class="wrapper">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="artilce_header">
    <h1 class="artilce_title" itemprop="name headline">Postgresqlç¬”è®°01åŸºæœ¬æ“ä½œ</h1>
    <p class="artilce_meta"><time datetime="2021-06-29T23:27:38+08:00" itemprop="datePublished">Jun 29, 2021</time> â€¢ <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Mark24</span></span></p>
  </header>

  <div class="article-content" itemprop="articleBody">
    <h1 id="ä¸»è¦ç›®æ ‡">ä¸»è¦ç›®æ ‡</h1>

<p>ç†Ÿæ‚‰å’Œç†è§£SQLçš„åŸºæœ¬æ“ä½œã€‚åŸºæœ¬åŠŸèƒ½å’Œé€»è¾‘ã€‚è¿™éƒ¨åˆ†å’Œå…¶ä»–æ•°æ®åº“å…±é€šã€‚å±äºæ ‡å‡†SQLèŒƒå›´ã€‚</p>

<h1 id="å­¦ä¹ èµ„æ–™">å­¦ä¹ èµ„æ–™</h1>

<p><a href="https://gitee.com/komavideo/LearnPostgreSql">èµ„æ–™</a></p>

<p><a href="https://www.bilibili.com/video/BV17W411P7hn?p=8&amp;spm_id_from=pageDriver">è§†é¢‘</a></p>

<h1 id="å®æˆ˜ç¬”è®°">å®æˆ˜ç¬”è®°</h1>

<p>å¦‚ä¸‹ï¼Œè‡ªæˆ‘éªŒè¯çš„ç¬”è®°ã€‚</p>
<h1 id="ä¸€å¼€å§‹">ä¸€ã€å¼€å§‹</h1>

<h2 id="å®‰è£…">å®‰è£…</h2>

<p>https://www.postgresql.org/download/</p>

<h3 id="å®‰è£…æŒ‡å®šç‰ˆæœ¬">å®‰è£…æŒ‡å®šç‰ˆæœ¬</h3>

<h4 id="ubuntu">Ubuntu</h4>

<p><code class="language-plaintext highlighter-rouge">sudo apt install postgresql-9.6</code></p>

<p>å®‰è£…æˆåŠŸæç¤ºï¼š</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
æˆåŠŸã€‚æ‚¨ç°åœ¨å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤å¼€å¯æ•°æ®åº“æœåŠ¡å™¨ï¼š

/usr/lib/postgresql/9.6/bin/pg_ctl -D /var/lib/postgresql/9.6/main -l logfile start

</code></pre></div></div>

<h4 id="mac">Mac</h4>

<p><code class="language-plaintext highlighter-rouge">brew install postgresql@9.6</code></p>

<p>å‚è€ƒ <a href="https://formulae.brew.sh/formula/postgresql">https://formulae.brew.sh/formula/postgresql</a></p>

<p>å®‰è£…æˆåŠŸæç¤º</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>If builds of PostgreSQL 9 are failing and you have version 8.x installed,
you may need to remove the previous version first. See:
  https://github.com/Homebrew/legacy-homebrew/issues/2510

This formula has created a default database cluster with:
  initdb /usr/local/var/postgresql@9.6
For more details, read:
  https://www.postgresql.org/docs/9/app-initdb.html

postgresql@9.6 is keg-only, which means it was not symlinked into /usr/local,
because this is an alternate version of another formula.

If you need to have postgresql@9.6 first in your PATH, run:
  echo 'export PATH="/usr/local/opt/postgresql@9.6/bin:$PATH"' &gt;&gt; ~/.zshrc

For compilers to find postgresql@9.6 you may need to set:
  export LDFLAGS="-L/usr/local/opt/postgresql@9.6/lib"
  export CPPFLAGS="-I/usr/local/opt/postgresql@9.6/include"

For pkg-config to find postgresql@9.6 you may need to set:
  export PKG_CONFIG_PATH="/usr/local/opt/postgresql@9.6/lib/pkgconfig"


To have launchd start postgresql@9.6 now and restart at login:
  brew services start postgresql@9.6
Or, if you don't want/need a background service you can just run:
  pg_ctl -D /usr/local/var/postgresql@9.6 start
==&gt; Summary
ğŸº  /usr/local/Cellar/postgresql@9.6/9.6.22: 1,651 files, 24.8MB

</code></pre></div></div>

<p>ä»”ç»†çœ‹è¿™é‡Œéœ€è¦æ‰§è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo 'export PATH="/usr/local/opt/postgresql@9.6/bin:$PATH"' &gt;&gt; ~/.zshrc
</code></pre></div></div>

<h3 id="å¸è½½">å¸è½½</h3>

<p>Ubuntu</p>

<p><code class="language-plaintext highlighter-rouge">sudo apt-get --purge remove postgresql\*</code></p>

<p>Mac</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew uninstall postgresql
</code></pre></div></div>

<h3 id="å¯åŠ¨æœåŠ¡">å¯åŠ¨æœåŠ¡</h3>

<p>Ubuntu</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo service postgresql start 
sudo service postgresql restart 
</code></pre></div></div>

<p>Mac</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew services start postgresql@9.6
</code></pre></div></div>

<h3 id="æŸ¥çœ‹çŠ¶æ€">æŸ¥çœ‹çŠ¶æ€</h3>

<p>Ubuntu</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pg_lsclusters
</code></pre></div></div>

<h2 id="1ä¿®æ”¹psqlçš„å¯†ç ">1.ä¿®æ”¹psqlçš„å¯†ç </h2>

<p>æƒ³è¦è¿›å…¥Postgresqlã€‚åœ¨Ubuntuä¸­ Postgresqlä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤ç”¨æˆ·postgres å¹¶ä¸”å¯†ç éšæœºã€‚æ‰€ä»¥éœ€è¦ä¿®æ”¹å¯†ç ã€‚</p>

<p>1ï¼‰ ç™»å½•Postgresql</p>

<p><code class="language-plaintext highlighter-rouge">sudo -u postgres psql</code></p>

<p>2ï¼‰ ä¿®æ”¹postgresçš„å¯†ç </p>

<p><code class="language-plaintext highlighter-rouge">ALTER USER postgres WITH PASSWORD 'postgres';</code></p>

<p>è¿™æ ·å¤–éƒ¨æ‰èƒ½æ­£å¸¸ä½¿ç”¨æ¯”å¦‚pgAdminç™»å½•è¿›å»ã€‚</p>

<h2 id="2ä¿®æ”¹linuxä¸­posgresçš„å¯†ç ">2.ä¿®æ”¹Linuxä¸­posgresçš„å¯†ç </h2>

<p>PostgreSQLä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„Linuxç”¨æˆ· postgresï¼Œä¿®æ”¹ç³»ç»Ÿä¸­è¿™ä¸ªç”¨æˆ·çš„å¯†ç </p>

<p>1ï¼‰ åˆ é™¤å¯†ç </p>

<p><code class="language-plaintext highlighter-rouge">sudo passwd -d postgres</code></p>

<p>2ï¼‰ è®¾ç½®å¯†ç </p>

<p><code class="language-plaintext highlighter-rouge">sudo -u postgres passwd</code></p>

<p>éµå¾ªç³»ç»Ÿæç¤ºå°±å¥½äº†ã€‚</p>

<h3 id="ubuntuä¸‹è¿›å…¥-psqlè¶…çº§ç”¨æˆ·æ“ä½œ">ubuntuä¸‹è¿›å…¥ psqlè¶…çº§ç”¨æˆ·æ“ä½œ</h3>

<p>1) ä»¥Postgresqlå»ºç«‹çš„ postgresç”¨æˆ·è¿›å…¥ psql</p>

<p><code class="language-plaintext highlighter-rouge">sudo -u postgres psql</code></p>

<p>2ï¼‰ æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“</p>

<p><code class="language-plaintext highlighter-rouge">\l</code></p>

<p>3) é€€å‡º æ•°æ®åº“ç•Œé¢</p>

<p><code class="language-plaintext highlighter-rouge">\q</code></p>

<p>4) è¿›å…¥ test  æ•°æ®åº“</p>

<p><code class="language-plaintext highlighter-rouge">\c test</code></p>

<p>5) åˆ—å‡ºæ‰€æœ‰è¡¨</p>

<p><code class="language-plaintext highlighter-rouge">\d</code></p>

<p>6) åˆ—å‡º testä¸‹ tb1 ä¿¡æ¯</p>

<p><code class="language-plaintext highlighter-rouge">\d tb1</code></p>

<h1 id="äºŒç®€å•ä½¿ç”¨">äºŒã€ç®€å•ä½¿ç”¨</h1>

<h2 id="1é»˜è®¤å»ºç«‹äº†ä¸€ä¸ªç”¨æˆ·-postgres">1.é»˜è®¤å»ºç«‹äº†ä¸€ä¸ªç”¨æˆ· postgres</h2>

<p>åˆ‡æ¢åˆ°ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ã€‚é»˜è®¤è´¦æˆ·ä¹Ÿæ˜¯ç³»ç»Ÿç®¡ç†å‘˜</p>

<h3 id="è¿›å…¥ç‰¹å®šç”¨æˆ·">è¿›å…¥ç‰¹å®šç”¨æˆ·</h3>

<p><code class="language-plaintext highlighter-rouge">sudo su postgres</code></p>

<blockquote>
  <p>Mac ç”¨æˆ·æ˜¯ brewå®‰è£…çš„ï¼Œç›´æ¥ä½¿ç”¨å¥½äº†ã€‚</p>
</blockquote>

<p>åœ¨ç”¨æˆ·çš„å…¨å±€æ·»åŠ äº†ä¸€äº›å…¨å±€çš„shellå‘½ä»¤ï¼Œæ¯”å¦‚å»ºç«‹æ•°æ®åº“ createdbï¼Œdropdb,  postgresqlçš„å‘½ä»¤è¡Œç¨‹åº psql</p>

<h3 id="æŸ¥çœ‹ç‰ˆæœ¬">æŸ¥çœ‹ç‰ˆæœ¬</h3>

<p><code class="language-plaintext highlighter-rouge">psql --version</code></p>

<h3 id="æŸ¥çœ‹æ•°æ®åº“åˆ—è¡¨">æŸ¥çœ‹æ•°æ®åº“åˆ—è¡¨</h3>

<p><code class="language-plaintext highlighter-rouge">psql -l</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
postgres@ubuntu:/home/mark24/LabSpace/sql-test$ psql -l
                                     æ•°æ®åº“åˆ—è¡¨
   åç§°    |  æ‹¥æœ‰è€…  | å­—å…ƒç¼–ç  |  æ ¡å¯¹è§„åˆ™   |    Ctype    |       å­˜å–æƒé™        
-----------+----------+----------+-------------+-------------+-----------------------
 markblog  | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 |
 postgres  | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 |
 template0 | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 | =c/postgres          +
           |          |          |             |             | postgres=CTc/postgres
 template1 | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 | =c/postgres          +
           |          |          |             |             | postgres=CTc/postgres
(4 è¡Œè®°å½•)
</code></pre></div></div>

<h3 id="åˆ›å»ºæ•°æ®åº“">åˆ›å»ºæ•°æ®åº“</h3>

<p><code class="language-plaintext highlighter-rouge">createdb  &lt;db name&gt;</code></p>

<h3 id="åˆ é™¤æ•°æ®åº“">åˆ é™¤æ•°æ®åº“</h3>

<p><code class="language-plaintext highlighter-rouge">dropdb &lt;db name&gt;</code></p>

<h3 id="è¿›å…¥æ•°æ®åº“">è¿›å…¥æ•°æ®åº“</h3>

<p><code class="language-plaintext highlighter-rouge">psql &lt;db name&gt;</code></p>

<p>è¿›å…¥æ•°æ®åº“ç•Œé¢ä¼šæ¢ä¸€ä¸ªæ ·å­:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgres@ubuntu:/home/mark24/LabSpace/sql-test$ psql markblog
psql (9.6.22)
è¾“å…¥ "help" æ¥è·å–å¸®åŠ©ä¿¡æ¯.

markblog=#
</code></pre></div></div>

<p>è¿›å…¥æ•°æ®åº“ä¹‹åï¼Œå¯ä»¥ç”¨ä¸€äº›ç®€å•ç¼©å†™å‘½ä»¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>markblog=# help
æ‚¨æ­£åœ¨ä½¿ç”¨psql, è¿™æ˜¯ä¸€ç§ç”¨äºè®¿é—®PostgreSQLçš„å‘½ä»¤è¡Œç•Œé¢
é”®å…¥ï¼š \copyright æ˜¾ç¤ºå‘è¡Œæ¡æ¬¾
       \h æ˜¾ç¤º SQL å‘½ä»¤çš„è¯´æ˜
       \? æ˜¾ç¤º pgsql å‘½ä»¤çš„è¯´æ˜
       \g æˆ–è€…ä»¥åˆ†å·(;)ç»“å°¾ä»¥æ‰§è¡ŒæŸ¥è¯¢
       \q é€€å‡º



\h  å¯ä»¥åŠ ä¸ŠSQLå…³é”®å­—æŸ¥çœ‹å…³é”®å­—ç”¨æ³•ï¼Œä»€ä¹ˆéƒ½ä¸åŠ ï¼Œæ‰“å¼€å…³é”®å­—åˆ—è¡¨
\?  åŠ ä¸Šå‘½ä»¤å¯ä»¥çœ‹å‘½ä»¤è§£é‡Šæ²¡ä»€ä¹ˆéƒ½ä¸åŠ ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„å‘½ä»¤åˆ—è¡¨



</code></pre></div></div>

<p>ä¸¤ä¸ªç³»ç»Ÿæä¾›çš„å‡½æ•°ã€‚è¿›å…¥DBä¹‹å</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>select  version();
select now();
</code></pre></div></div>

<h1 id="ä¸‰æ“ä½œæ•°æ®è¡¨">ä¸‰ã€æ“ä½œæ•°æ®è¡¨</h1>

<h2 id="1å»ºç«‹ä¸€ä¸ªæ•°æ®è¡¨">1.å»ºç«‹ä¸€ä¸ªæ•°æ®è¡¨</h2>

<p><code class="language-plaintext highlighter-rouge">create table</code></p>

<p>ä¾‹å¦‚</p>

<p><code class="language-plaintext highlighter-rouge">CREATE TABLE postes ( title varchar(255), content text);</code></p>

<p><code class="language-plaintext highlighter-rouge">\dt</code> å¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤åˆ—å‡ºæ‰€æœ‰çš„è¡¨æŸ¥çœ‹</p>

<h1 id="2åˆ é™¤ä¸€ä¸ªæ•°æ®è¡¨">2.åˆ é™¤ä¸€ä¸ªæ•°æ®è¡¨</h1>

<p><code class="language-plaintext highlighter-rouge">drop table</code></p>

<p><code class="language-plaintext highlighter-rouge">drop table &lt;table name&gt;;</code></p>

<h1 id="3ä½¿ç”¨sql-æ–‡ä»¶å»ºç«‹è¡¨æ ¼">3.ä½¿ç”¨sql æ–‡ä»¶å»ºç«‹è¡¨æ ¼</h1>

<p>1) æ¨å‡ºæ•°æ®åº“æ¨¡å¼</p>

<p>2) vim ç¼–è¾‘æ–‡ä»¶ æ¯”å¦‚ db.sql</p>

<blockquote>
  <p>db.sql</p>
  <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">postes</span> <span class="p">(</span> <span class="n">title</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">content</span> <span class="nb">text</span><span class="p">);</span>
</code></pre></div>  </div>
</blockquote>

<p>3) è¿›å…¥ database å³  posql <database name=""></database></p>

<p>iå‘½ä»¤å¯¼å…¥äº†sqlæ–‡ä»¶æ‰§è¡Œ</p>

<p><code class="language-plaintext highlighter-rouge">\i  db.sql</code></p>

<p>4) å˜æ›´è¡¨å</p>

<p><code class="language-plaintext highlighter-rouge">alter table &lt;old table name&gt; rename to &lt;new table name&gt;;</code></p>

<p>5) åˆ—å‡ºæ‰€æœ‰çš„è¡¨ï¼ŒæŸ¥çœ‹</p>

<p><code class="language-plaintext highlighter-rouge">\dt</code></p>

<p>6) æŸ¥çœ‹è¡¨çš„æè¿°</p>

<p><code class="language-plaintext highlighter-rouge">\d  &lt;table name&gt;</code></p>

<p>7) åˆ é™¤ä¸€ä¸ªè¡¨</p>

<p><code class="language-plaintext highlighter-rouge">DROP TABLE &lt;table name&gt;;</code></p>

<h1 id="å››-å­—æ®µç±»å‹">å››ã€ å­—æ®µç±»å‹</h1>

<p>ä»…ä»…åˆ—å‡ºå·¥ä½œä¸­æ¯”è¾ƒå¸¸ç”¨çš„ï¼š</p>

<h2 id="æ•°å­—">æ•°å­—</h2>

<ul>
  <li>
    <p>integer(int)</p>

    <p>å››ä¸ªå­—èŠ‚</p>
  </li>
  <li>
    <p>real</p>

    <p>å››ä¸ªå­—èŠ‚ï¼Œæµ®ç‚¹æ•°</p>
  </li>
  <li>
    <p>serial</p>

    <p>åºåˆ—ï¼Œç”¨äºè‡ªå¢ID</p>
  </li>
</ul>

<h2 id="æ–‡å­—">æ–‡å­—</h2>

<ul>
  <li>
    <p>char</p>

    <p>å®šé•¿å­—ç¬¦ã€‚æ¯”å¦‚10ä¸ªå­—ç¬¦ç©ºé—´ï¼Œèµ‹å€¼2ä¸ªï¼Œå…¶ä½™8ä¸ªç•™ç©º</p>
  </li>
  <li>
    <p>varchar
  å¸¸ç”¨ã€‚å˜é•¿ã€‚æ¯”å¦‚10ä¸ªå­—ç¬¦ï¼Œèµ‹å€¼2ä¸ªå°±æ˜¯2ä¸ªã€‚</p>
  </li>
  <li>
    <p>text</p>

    <p>å¤§æ–‡æœ¬</p>
  </li>
</ul>

<h2 id="å¸ƒå°”">å¸ƒå°”</h2>

<ul>
  <li>boolean</li>
</ul>

<h1 id="æ—¥æœŸ">æ—¥æœŸ</h1>

<ul>
  <li>
    <p>date</p>

    <p>å¹´æœˆæ—¥</p>
  </li>
  <li>
    <p>time</p>

    <p>æ—¶åˆ†ç§’</p>
  </li>
  <li>
    <p>timestamp</p>

    <p>å¹´æœˆæ—¥+æ—¶åˆ†ç§’</p>
  </li>
</ul>

<h1 id="ç‰¹è‰²ç±»å‹">ç‰¹è‰²ç±»å‹</h1>

<ul>
  <li>
    <p>Array</p>
  </li>
  <li>
    <p>ç½‘ç»œåœ°å€å‹ï¼ˆinetï¼‰</p>
  </li>
  <li>
    <p>JSONå‹</p>
  </li>
  <li>
    <p>XMLå‹</p>
  </li>
</ul>

<p>å…¨éƒ¨çš„æ•°æ®ç±»å‹å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://www.postgresql.org/docs/9.6/datatype.html">Postgresql 9.6 datatype</a></p>

<h1 id="äº”çº¦æŸ">äº”ã€çº¦æŸ</h1>

<p>å¯¹å­—æ®µçš„ä¸€äº›é™åˆ¶å°±æ˜¯çº¦æŸã€‚</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">posts</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">serial</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
  <span class="n">title</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">content</span> <span class="nb">text</span> <span class="k">check</span><span class="p">(</span><span class="k">length</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">),</span>
  <span class="n">if_draft</span> <span class="nb">boolean</span> <span class="k">default</span> <span class="k">TRUE</span><span class="p">,</span>
  <span class="n">is_del</span> <span class="nb">boolean</span> <span class="k">default</span> <span class="k">FALSE</span><span class="p">,</span>
  <span class="n">created_date</span> <span class="nb">timestamp</span> <span class="k">default</span> <span class="s1">'now'</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="çº¦æŸä¸¾ä¾‹å­è§£é‡Š">çº¦æŸä¸¾ä¾‹å­è§£é‡Š</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>not null ä¸èƒ½ä¸ºç©º

unique åœ¨æ‰€æœ‰æ•°æ®ä¸­å¿…é¡»å”¯ä¸€

check å­—æ®µè®¾ç½®æ¡ä»¶

default  é»˜è®¤å€¼

primary key (not null, unique)  ä¸»é”®ï¼Œè‡ªå¸¦ä¸¤ä¸ªå±æ€§ï¼Œéç©ºï¼Œä¸é‡å¤
</code></pre></div></div>

<h2 id="ä»£ç åˆ†æ">ä»£ç åˆ†æ</h2>

<ul>
  <li>
    <p>IDä½œä¸ºä¸»é”®</p>

    <p>å•ä¸€IDåšä¸»é”®æ–¹ä¾¿å¢åˆ æŸ¥æ”¹
primary key  æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œæ ‡è®°æ˜¯ä¸»é”®ï¼ˆæš—å«äº†ï¼Œnot null ä¸” uniqueï¼‰
serial æ˜¯è‡ªå¢ç±»å‹</p>
  </li>
  <li>
    <p>æ ‡é¢˜</p>

    <p>varchar å˜é•¿ï¼Œæœ€é•¿255ï¼Œéç©º</p>
  </li>
  <li>
    <p>å†…å®¹</p>

    <p>å†…å®¹é•¿åº¦å¿…é¡» &gt;8</p>
  </li>
  <li>
    <p>è‰ç¨¿æ ‡è®°</p>

    <p>é»˜è®¤æ˜¯è‰ç¨¿</p>
  </li>
  <li>
    <p>è½¯åˆ é™¤æ ‡è®°</p>

    <p>é»˜è®¤æ˜¯ä¸åˆ é™¤</p>

    <p>æ¨èåšé€»è¾‘åˆ é™¤ã€‚</p>
  </li>
  <li>
    <p>åˆ›å»ºæ—¶é—´</p>
  </li>
</ul>

<h1 id="å…­insertè¯­å¥">å…­ã€Insertè¯­å¥</h1>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">table</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="p">...)</span> <span class="k">values</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">...)</span>
</code></pre></div></div>

<h3 id="sql-å®éªŒ">sql å®éªŒ</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 1. çº¦æŸä¾¿æ·</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">posts</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>

<span class="c1">-- ERROR:  new row for relation "posts" violates check constraint "posts_content_check"</span>
<span class="c1">-- DETAIL:  Failing row contains (2, , , t, f, 2021-06-30 13:34:41.442131).</span>

<span class="c1">-- 2. æ ‡é¢˜null</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">posts</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>

<span class="c1">-- ERROR:  null value in column "title" violates not-null constraint</span>
<span class="c1">-- DETAIL:  Failing row contains (3, null, , t, f, 2021-06-30 13:34:41.442131).</span>

<span class="c1">-- 3. å…¨å¯¹çš„æƒ…å†µ</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">posts</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'title'</span> <span class="p">,</span> <span class="s1">'content ABC'</span><span class="p">);</span>

<span class="c1">-- markblog=# insert into posts (title, content) values ('title' , 'content ABC');</span>
<span class="c1">-- INSERT 0 1</span>

<span class="c1">-- æ’å…¥æˆåŠŸ,æŸ¥çœ‹æ’å…¥ç»“æœï¼Œéœ€è¦ç”¨selectã€‚ æƒ³æƒ³ä¸€ä¸‹ selectå°±åƒåœ¨excelä¸­é€‰æ‹©ç‰¹å®šçš„åˆ—ï¼Œç„¶åä¼šè¿”å›ç‰¹å®šçš„è¡Œã€‚</span>

<span class="k">select</span>  <span class="o">*</span> <span class="k">from</span>  <span class="n">posts</span><span class="p">;</span>
<span class="c1">--  id | title |   content   | if_draft | is_del |        created_date</span>
<span class="c1">-- ----+-------+-------------+----------+--------+----------------------------</span>
<span class="c1">--   4 | title | content ABC | t        | f      | 2021-06-30 13:34:41.442131</span>
<span class="c1">-- (1 row)</span>

</code></pre></div></div>

<blockquote>
  <p>ç†è§£ selectï¼ŒæŸ¥çœ‹æ’å…¥ç»“æœï¼Œéœ€è¦ç”¨selectã€‚ æƒ³æƒ³ä¸€ä¸‹ selectå°±åƒåœ¨excelä¸­é€‰æ‹©ç‰¹å®šçš„åˆ—ï¼Œç„¶åä¼šè¿”å›ç‰¹å®šçš„è¡Œã€‚</p>
</blockquote>

<h1 id="ä¸ƒselect-è¯­å¥">ä¸ƒã€Select è¯­å¥</h1>

<p>selectçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚</p>

<p>å®æˆ˜éƒ¨åˆ†ï¼Œå…ˆè¦å‡†å¤‡æ•°æ®ã€‚</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">users</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">serial</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
  <span class="n">player</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">score</span> <span class="nb">real</span><span class="p">,</span>
  <span class="n">team</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">);</span>


<span class="k">insert</span> <span class="k">into</span> <span class="n">users</span> <span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">team</span><span class="p">)</span> 
<span class="k">values</span>
<span class="p">(</span><span class="s1">'tom'</span><span class="p">,</span> <span class="mi">28</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'A'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'nick'</span><span class="p">,</span> <span class="mi">98</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'B'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'mark'</span><span class="p">,</span> <span class="mi">30</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'C'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'linda'</span><span class="p">,</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'D'</span><span class="p">);</span>

</code></pre></div></div>

<p>SQLå®æˆ˜</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 1. æ‹¿å‡ºæ‰€æœ‰æ•°æ®</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">--  id | player | score | team</span>
<span class="c1">-- ----+--------+-------+------</span>
<span class="c1">--   1 | tom    |  28.4 | A</span>
<span class="c1">--   2 | nick   |  98.4 | B</span>
<span class="c1">--   3 | mark   |  30.4 | C</span>
<span class="c1">--   4 | linda  |   100 | D</span>
<span class="c1">-- (4 rows)</span>

<span class="c1">-- 1.1 \x å­—æ®µæ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡å¢åŠ  \x è¿”å›è®©å­—æ®µæ›´æ¸…æ™°ã€‚ \x æ˜¯ä¸€ä¸ªå¼€å…³ã€‚ä¸Šä¸‹æ–‡è°ƒç”¨å‘ˆç° toggleå¼€å…³æ•ˆæœ</span>

<span class="err">\</span><span class="n">x</span>

<span class="c1">-- markblog=# \x</span>
<span class="c1">-- Expanded display is on.</span>
<span class="c1">-- markblog=# select * from users;</span>
<span class="c1">-- -[ RECORD 1 ]-</span>
<span class="c1">-- id     | 1</span>
<span class="c1">-- player | tom</span>
<span class="c1">-- score  | 28.4</span>
<span class="c1">-- team   | A</span>
<span class="c1">-- -[ RECORD 2 ]-</span>
<span class="c1">-- id     | 2</span>
<span class="c1">-- player | nick</span>
<span class="c1">-- score  | 98.4</span>
<span class="c1">-- team   | B</span>
<span class="c1">-- -[ RECORD 3 ]-</span>
<span class="c1">-- id     | 3</span>
<span class="c1">-- player | mark</span>
<span class="c1">-- score  | 30.4</span>
<span class="c1">-- team   | C</span>
<span class="c1">-- -[ RECORD 4 ]-</span>
<span class="c1">-- id     | 4</span>
<span class="c1">-- player | linda</span>
<span class="c1">-- score  | 100</span>
<span class="c1">-- team   | D</span>


<span class="c1">-- å†æ¬¡è¿è¡Œ \x å¯ä»¥å…³é—­</span>

<span class="c1">-- 2. é€‰å‡ºç›®æ ‡å­—æ®µ</span>

<span class="k">select</span> <span class="n">player</span><span class="p">,</span> <span class="n">score</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>
</code></pre></div></div>

<h1 id="å…«whereè¯­å¥">å…«ã€whereè¯­å¥</h1>

<p>whereè¯­å¥åŸºæœ¬ä½¿ç”¨ã€‚é…åˆæå–ã€æ›´æ–°åˆ é™¤ã€‚ç”¨äºè¿‡æ»¤æ¡ä»¶ã€‚</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">;</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="k">and</span> <span class="n">score</span> <span class="o">&lt;</span><span class="mi">30</span> <span class="p">;</span>

<span class="c1">-- ç­‰äº</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">team</span> <span class="o">=</span> <span class="s1">'A'</span><span class="p">;</span>

<span class="c1">-- ä¸ç­‰äº</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">team</span> <span class="o">!=</span> <span class="s1">'A'</span><span class="p">;</span>

<span class="c1">-- %è¡¨ç¤ºåé¢æ‰€æœ‰æ•°æ®</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">player</span> <span class="k">like</span> <span class="s1">'t%'</span><span class="p">;</span>

<span class="c1">-- _è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">player</span> <span class="k">like</span> <span class="s1">'t_'</span><span class="p">;</span>



</code></pre></div></div>

<p>å®éªŒç»“æœ</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># \x</span>
Expanded display is off.
<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users;</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  1 | tom    |  28.4 | A
  2 | nick   |  98.4 | B
  3 | mark   |  30.4 | C
  4 | linda  |   100 | D
<span class="o">(</span>4 rows<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where score &gt; 20;</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  1 | tom    |  28.4 | A
  2 | nick   |  98.4 | B
  3 | mark   |  30.4 | C
  4 | linda  |   100 | D
<span class="o">(</span>4 rows<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where score &gt; 50;</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  2 | nick   |  98.4 | B
  4 | linda  |   100 | D
<span class="o">(</span>2 rows<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where score &gt; 20 and score &lt;30 ;</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  1 | tom    |  28.4 | A
<span class="o">(</span>1 row<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where team = 'A';</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  1 | tom    |  28.4 | A
<span class="o">(</span>1 row<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where team != 'A';</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  2 | nick   |  98.4 | B
  3 | mark   |  30.4 | C
  4 | linda  |   100 | D
<span class="o">(</span>3 rows<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where player like 't%';</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  1 | tom    |  28.4 | A
<span class="o">(</span>1 row<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where player like 't_';</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
<span class="o">(</span>0 rows<span class="o">)</span>


</code></pre></div></div>

<h1 id="ä¹æ•°æ®æŠ½å‡ºé€‰é¡¹">ä¹ã€æ•°æ®æŠ½å‡ºé€‰é¡¹</h1>

<p>selectè¯­å¥åœ¨æŠ½å‡ºæ•°æ®æ—¶ï¼Œå¯ä»¥å¯¹è¯­å¥è®¾ç½®æ›´å¤šçš„é€‰é¡¹ï¼Œå·²å¾—åˆ°æƒ³è¦çš„æ•°æ®ã€‚</p>

<ul>
  <li>order by</li>
  <li>limit</li>
  <li>offset</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- å‡åºï¼šä»å°åˆ°å¤§æ’åº ï¼ˆé»˜è®¤ï¼‰</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">score</span> <span class="k">asc</span><span class="p">;</span>
<span class="c1">-- é™åºï¼šä»å¤§åˆ°å°æ’åº</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">score</span> <span class="k">desc</span><span class="p">;</span>
<span class="c1">-- å‡åº</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span><span class="p">;</span>
<span class="c1">-- å…ˆæŒ‰ç…§å›¢é˜Ÿå‡åºï¼Œåœ¨æŒ‰ç…§åˆ†æ•°å‡åº</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span><span class="p">,</span> <span class="n">score</span><span class="p">;</span>
<span class="c1">-- å›¢é˜Ÿå‡åºï¼Œåˆ†æ•°é™åº</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span><span class="p">,</span> <span class="n">score</span> <span class="k">desc</span><span class="p">;</span>
<span class="c1">-- å›¢é˜Ÿé™åºï¼Œåˆ†æ•°é™åº</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span> <span class="k">desc</span><span class="p">,</span> <span class="n">score</span> <span class="k">desc</span><span class="p">;</span>
<span class="c1">-- å›¢é˜Ÿï¼Œè·å¾—å‰ä¸‰ï¼Œ é»˜è®¤offsetæ˜¯0</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span> <span class="k">desc</span> <span class="k">limit</span> <span class="mi">3</span><span class="p">;</span>
<span class="c1">-- ä»ç¬¬ä¸€ååé¢ï¼Œå–ä¸‰ä¸ª å³ 2ï¼Œ3ï¼Œ4</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span> <span class="k">desc</span> <span class="k">limit</span> <span class="mi">3</span> <span class="k">offset</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">-- limitå’Œoffsetå¯ä»¥å®Œæˆåˆ†é¡µæ“ä½œ</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span> <span class="k">desc</span> <span class="k">limit</span> <span class="mi">3</span> <span class="k">offset</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div></div>

<h1 id="åç»Ÿè®¡æŠ½å‡ºé€‰é¡¹">åã€ç»Ÿè®¡æŠ½å‡ºé€‰é¡¹</h1>

<ul>
  <li>distinct  è¿‡æ»¤é‡å¤æ•°æ®</li>
  <li>sum æ±‚å’Œ</li>
  <li>max/min æœ€å¤§å€¼/æœ€å°å€¼</li>
  <li>group by / having   å¯¹é›†åˆè¿›è¡Œåˆ†ç»„ç„¶åè®¡ç®—</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">-- å»é‡</span>
 <span class="k">select</span> <span class="k">distinct</span> <span class="n">team</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- è¿›è¡Œæ±‚å’Œ</span>
 <span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- æ±‚æœ€é«˜</span>
<span class="c1">-- è¿™é‡Œä½¿ç”¨å‡½æ•°ï¼Œselect &lt;åˆ†ç»„ID&gt;, min(score) from users; å°†æ˜¯æ— æ•ˆè¯­å¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæ±‡æ€»è¯­å¥ï¼Œéœ€è¦è·Ÿä¸Š group by </span>
<span class="c1">-- select &lt;åˆ†ç»„ID&gt;, min(score) from users group by &lt;åˆ†ç»„ID&gt;; æ‰æ˜¯æœ‰æ•ˆçš„</span>
 <span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

 <span class="k">select</span> <span class="k">min</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- è¡¨ä¸­å¾—åˆ†æœ€å¤š çš„ é˜Ÿå‘˜ä¿¡æ¯</span>
 <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">score</span> <span class="o">=</span> <span class="p">(</span><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">);</span>
 <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">score</span> <span class="o">=</span> <span class="p">(</span><span class="k">select</span> <span class="k">min</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">);</span>

 <span class="k">select</span> <span class="n">team</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span> <span class="k">group</span> <span class="k">by</span> <span class="n">team</span><span class="p">;</span>

<span class="c1">--  havingæ˜¯åˆ†ç»„ä¸­çš„whereï¼Œå°±æ˜¯å¯¹åˆ†ç»„æ•°æ®çš„è¿‡æ»¤ã€‚</span>
 <span class="k">select</span> <span class="n">team</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span> <span class="k">group</span> <span class="k">by</span> <span class="n">team</span> <span class="k">having</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">;</span>

<span class="c1">--  max(score) å…¶å®å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹å­—æ®µäº†ã€‚ è¿™é‡Œ as æœªç”Ÿæ•ˆ</span>
 <span class="k">select</span> <span class="n">team</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span> <span class="k">group</span> <span class="k">by</span> <span class="n">team</span> <span class="k">having</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">25</span> <span class="k">order</span> <span class="k">by</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">);</span>
</code></pre></div></div>

<h1 id="åä¸€æ–¹ä¾¿å‡½æ•°">åä¸€ã€æ–¹ä¾¿å‡½æ•°</h1>

<p>çŸ¥è¯†ç‚¹</p>

<ul>
  <li>length</li>
  <li>concat</li>
  <li>alias</li>
  <li>substring åˆ‡å‰²å­—ç¬¦ä¸²</li>
  <li>random</li>
</ul>

<p><a href="https://www.postgresql.org/docs/9.6/functions.html">æ›´å¤šå‚è€ƒ https://www.postgresql.org/docs/9.6/functions.html</a></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- è·å¾—playerçš„é•¿åº¦</span>
<span class="k">select</span> <span class="n">player</span><span class="p">,</span> <span class="k">length</span><span class="p">(</span><span class="n">player</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="k">select</span> <span class="n">player</span><span class="p">,</span> <span class="n">concat</span><span class="p">(</span><span class="n">player</span><span class="p">,</span><span class="s1">'/'</span><span class="p">,</span><span class="n">team</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- select player, count(player) from users; è¿™å¥ä¸èƒ½å·¥ä½œã€‚å‡½æ•°åº”ç”¨åœºæ™¯ä¸åŒ</span>


<span class="c1">-- èµ·ä¸€ä¸ªåˆ«å</span>
<span class="c1">-- è­¦å‘Šâš ï¼šä¸€å®šè¦æ˜¯åŒå¼•å·</span>
<span class="k">select</span> <span class="n">player</span><span class="p">,</span> <span class="n">concat</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">,</span> <span class="n">team</span><span class="p">)</span> <span class="k">as</span> <span class="nv">"çƒå‘˜ä¿¡æ¯"</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>


<span class="c1">-- å¦‚æœä¸åŠ as å­—æ®µåå­—æ˜¯å‡½æ•°å</span>

<span class="c1">-- testblog=# select player, concat(player, '/', team) from users;</span>
<span class="c1">--  player |  concat  </span>
<span class="c1">-- --------+----------</span>
<span class="c1">--  tom    | tom/A</span>
<span class="c1">--  nick   | nick/B</span>
<span class="c1">--  mark24 | mark24/C</span>
<span class="c1">--  m-pl   | m-pl/C</span>
<span class="c1">--  kk     | kk/C</span>
<span class="c1">--  SSark  | SSark/C</span>
<span class="c1">--  dddk   | dddk/C</span>
<span class="c1">--  linda  | linda/D</span>
<span class="c1">-- (8 è¡Œè®°å½•)</span>

<span class="c1">-- ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹åˆ‡ï¼Œåˆ‡ä¸€ä¸ª</span>
<span class="k">select</span> <span class="k">substring</span><span class="p">(</span><span class="n">team</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="nv">"çƒé˜Ÿé¦–æ–‡å­—"</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- 'æˆ‘' å•å¼•å·ä½œä¸ºå­—ç¬¦ä¸²ï¼ŒåŒå¼•å·ä½œä¸ºå˜é‡è¯†åˆ«</span>
<span class="k">select</span> <span class="n">concat</span><span class="p">(</span><span class="s1">'æˆ‘'</span><span class="p">,</span><span class="k">substring</span><span class="p">(</span><span class="n">team</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="k">as</span> <span class="nv">"çƒé˜Ÿé¦–æ–‡å­—"</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="k">select</span> <span class="n">random</span><span class="p">();</span>

<span class="c1">-- éšæœºæ’åºï¼ŒæŠ½å¥–çš„æ—¶å€™å¯ä»¥ç”¨</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">random</span><span class="p">();</span>

<span class="c1">-- éšå³é€‰æ‹©ä¸€ä¸ªç”¨æˆ·</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">random</span><span class="p">()</span> <span class="k">limit</span> <span class="k">by</span> <span class="mi">1</span><span class="p">;</span>

</code></pre></div></div>

<h1 id="åäºŒæ›´æ–°å’Œåˆ é™¤">åäºŒã€æ›´æ–°å’Œåˆ é™¤</h1>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">update</span> <span class="p">[</span><span class="k">table</span> <span class="n">name</span><span class="p">]</span> <span class="k">set</span> <span class="p">[</span><span class="n">field</span><span class="o">=</span><span class="n">newValue</span><span class="p">,....]</span>  <span class="k">where</span> <span class="p">...</span>


<span class="c1">-- è¿™ä¸ªæ˜¯ç‰©ç†åˆ é™¤</span>
<span class="k">delete</span> <span class="k">from</span> <span class="p">[</span><span class="k">table</span> <span class="n">name</span><span class="p">]</span> <span class="k">where</span> <span class="p">....</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">-- æ›´æ–°å±æ€§</span>
<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">score</span> <span class="o">=</span> <span class="mi">29</span><span class="p">.</span><span class="mi">1</span> <span class="k">where</span> <span class="n">player</span> <span class="o">=</span> <span class="s1">'mark'</span><span class="p">;</span>

<span class="c1">-- å±æ€§è‡ª+1</span>
<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">where</span> <span class="n">team</span> <span class="o">=</span> <span class="s1">'A'</span><span class="p">;</span>


<span class="c1">-- ç»™å®šèŒƒå›´</span>
<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">+</span> <span class="mi">100</span> <span class="k">where</span> <span class="n">team</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'A'</span><span class="p">,</span> <span class="s1">'B'</span><span class="p">);</span>


<span class="c1">-- æ¡ä»¶ç‰©ç†åˆ é™¤</span>
<span class="k">delete</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">;</span>

</code></pre></div></div>

<h1 id="åä¸‰æ›´æ–°è¡¨ç»“æ„">åä¸‰ã€æ›´æ–°è¡¨ç»“æ„</h1>

<p>çŸ¥è¯†ç‚¹</p>

<ul>
  <li>alter table [table name] â€¦</li>
</ul>

<p>åˆ›å»ºç´¢å¼•</p>
<ul>
  <li>create index â€¦
åˆ é™¤ç´¢å¼•</li>
  <li>drop index â€¦</li>
</ul>

<p>å¯¹éœ€è¦çš„å­—æ®µå¢åŠ ç´¢å¼•æŸ¥è¯¢çš„é€Ÿåº¦ä¼šæå‡ã€‚</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- æŸ¥çœ‹usersè¡¨ç»“æ„</span>
<span class="err">\</span><span class="n">d</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- ç»™usersè¡¨æ–°å¢å­—æ®µ</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">users</span> <span class="k">add</span> <span class="n">fullname</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>

<span class="c1">-- åˆ é™¤å­—æ®µ</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">users</span> <span class="k">drop</span> <span class="n">fullname</span><span class="p">;</span>

<span class="c1">-- æ›´æ”¹å­—æ®µå</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">users</span> <span class="k">rename</span> <span class="n">player</span> <span class="k">to</span> <span class="n">nba_player</span><span class="p">;</span>

<span class="c1">-- æ›´æ”¹è¡¨ä¸­æŸä¸ªå­—æ®µçš„ç±»å‹</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">users</span> <span class="k">alter</span> <span class="n">nba_player</span> <span class="k">type</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

<span class="c1">-- ç”¨ users(nba_player) çš„å­—æ®µï¼Œåˆ›å»ºç´¢å¼•ï¼Œç´¢å¼•åå­—ä¸º nba_player_index</span>
<span class="k">create</span> <span class="k">index</span> <span class="n">nba_player_index</span> <span class="k">on</span> <span class="n">users</span><span class="p">(</span><span class="n">nba_player</span><span class="p">);</span>


<span class="c1">-- åˆ é™¤åˆ¶å®šç´¢å¼•</span>
<span class="k">drop</span> <span class="k">index</span> <span class="n">nba_player_index</span><span class="p">;</span>
</code></pre></div></div>

<h1 id="åå››æ“ä½œå¤šä¸ªè¡¨">åå››ã€æ“ä½œå¤šä¸ªè¡¨</h1>

<p>è¡¨ç»“åˆæŸ¥è¯¢çš„åŸºç¡€çŸ¥è¯†</p>

<p>æ•°æ®å‡†å¤‡,è¯·æ¸…ç©ºä¹‹å‰çš„æ•°æ®</p>

<p>reinit.sql</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">users</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">serial</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="n">player</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">score</span> <span class="nb">real</span><span class="p">,</span>
    <span class="n">team</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">);</span>


<span class="k">insert</span> <span class="k">into</span> <span class="n">users</span> <span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">team</span><span class="p">)</span> <span class="k">values</span>
<span class="p">(</span><span class="s1">'åº“é‡Œ'</span><span class="p">,</span> <span class="mi">28</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'å‹‡å£«'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'å“ˆç™»'</span><span class="p">,</span> <span class="mi">30</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'ç«ç®­'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'é˜¿æœ'</span><span class="p">,</span> <span class="mi">25</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">'å‹‡å£«'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'é˜¿è©¹'</span><span class="p">,</span> <span class="mi">27</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span> <span class="s1">'éª‘å£«'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'ç¥é¾Ÿ'</span><span class="p">,</span> <span class="mi">31</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'é›·éœ†'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'ç™½è¾¹'</span><span class="p">,</span> <span class="mi">19</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span> <span class="s1">'çƒ­ç«'</span><span class="p">);</span>

<span class="c1">-- é€šè¿‡user_id è¿›è¡Œé€»è¾‘å…³è”</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">twitters</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">serial</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="n">user_id</span> <span class="nb">integer</span><span class="p">,</span>
    <span class="n">content</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">twitters</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span> <span class="k">values</span> 
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'ä»Šå¤©æœ‰æ—¶å¤§èƒœ'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'æˆ‘å¾—äº†60åˆ†'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'è·èƒœèµä¸æ€•'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'æ˜å¹´åœ¨æ¥'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'æˆ‘20+'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'èµ°äº†ã€‚'</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">twitters</span><span class="p">;</span>


<span class="c1">-- ç»„åˆä¸¤å¼ è¡¨çš„æ•°æ®</span>
<span class="k">select</span> <span class="n">users</span><span class="p">.</span><span class="n">player</span><span class="p">,</span> <span class="n">twitters</span><span class="p">.</span><span class="n">content</span> <span class="k">from</span> <span class="n">users</span><span class="p">,</span> <span class="n">twitters</span> <span class="k">where</span> <span class="n">users</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">twitters</span><span class="p">.</span><span class="n">user_id</span><span class="p">;</span>

<span class="c1">-- è¾“å‡ºç»“æœ</span>
<span class="c1">-- marktest=# select users.player, twitters.content from users, twitters where users.id = twitters.user_id;</span>
<span class="c1">--  player |   content    </span>
<span class="c1">-- --------+--------------</span>
<span class="c1">--  åº“é‡Œ   | ä»Šå¤©æœ‰æ—¶å¤§èƒœ</span>
<span class="c1">--  å“ˆç™»   | æˆ‘å¾—äº†60åˆ†</span>
<span class="c1">--  é˜¿æœ   | è·èƒœèµä¸æ€•</span>
<span class="c1">--  é˜¿è©¹   | æ˜å¹´åœ¨æ¥</span>
<span class="c1">--  ç¥é¾Ÿ   | æˆ‘20+</span>
<span class="c1">--  åº“é‡Œ   | èµ°äº†ã€‚</span>
<span class="c1">-- (6 è¡Œè®°å½•)</span>



<span class="c1">-- è·å¾—æ‰€æœ‰çš„çƒå‘˜</span>
<span class="c1">-- ä½¿ç”¨ as è¿›è¡Œåˆ«åç¼©çŸ­ sqlï¼Œæ³¨æ„çš„æ˜¯è¿™é‡Œæ˜¯fromåé¢æ ‡è®°äº†ã€‚ç„¶åå…¶ä»–éƒ¨åˆ†å¯ä»¥ä½¿ç”¨ã€‚å…¶å®fromæ˜¯æœ€å…ˆæ‰§è¡Œçš„ã€‚</span>
<span class="c1">-- selectå’Œwhereæ¶‰åŠåˆ°ä¸¤ä¸ªè¡¨,é€šè¿‡ä¸€ä¸ªIdå®ç°å…³è” - è¿™å°±æ˜¯è¡¨å…³è”</span>
<span class="k">select</span> <span class="n">u</span><span class="p">.</span><span class="n">player</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">content</span> <span class="k">from</span> <span class="n">users</span> <span class="k">as</span> <span class="n">u</span><span class="p">,</span> <span class="n">twitters</span> <span class="k">as</span> <span class="n">t</span> <span class="k">where</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">user_id</span><span class="p">;</span>

<span class="c1">-- ç­›é€‰ä¸€ä¸ªç”¨æˆ·id=1çš„</span>
<span class="k">select</span> <span class="n">u</span><span class="p">.</span><span class="n">player</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">content</span> <span class="k">from</span> <span class="n">users</span> <span class="k">as</span> <span class="n">u</span><span class="p">,</span> <span class="n">twitters</span> <span class="k">as</span> <span class="n">t</span> <span class="k">where</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">user_id</span> <span class="k">and</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<h1 id="åäº”ä½¿ç”¨è§†å›¾">åäº”ã€ä½¿ç”¨è§†å›¾</h1>

<p>æ¦‚å¿µ:è§†å›¾(View) æ˜¯ä»ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨å¯¼å‡ºçš„å¯¹è±¡,è§†å›¾ä¸è¡¨ä¸åŒ,è§†å›¾æ˜¯ä¸€ä¸ªè™šè¡¨,å³è§†å›¾æ‰€å¯¹åº”çš„æ•°æ®ä¸è¿›è¡Œå®é™…å­˜å‚¨.æ•°æ®åº“åªå­˜å‚¨è§†å›¾çš„å®šä¹‰,åœ¨å¯¹è§†å›¾çš„æ•°æ®è¿›è¡Œæ“ä½œæ—¶,ç³»ç»Ÿæ ¹æ®è§†å›¾çš„å®šä¹‰å»æ“ä½œä¸è§†å›¾ç›¸å…³è”çš„åŸºæœ¬è¡¨.</p>

<p>ç™½è¯è§£é‡Š:</p>

<p>è§†å›¾å°±æ˜¯ä¸€ä¸ªselectè¯­å¥,æŠŠä¸šåŠ¡ä¸­å¸¸ç”¨çš„selectè¯­å¥ç®€åŒ–æˆä¸€ä¸ªç±»ä¼¼è¡¨çš„å¯¹è±¡,ä¾¿äºç®€å•çš„è¯»å–å’Œå¼€å‘ã€‚</p>

<p>ç›¸å½“äºä¸€ä¸ªé€»è¾‘è¡¨ã€‚</p>

<p>çŸ¥è¯†ç‚¹:</p>

<p>ä½¿ç”¨æ•°æ®åº“è§†å›¾</p>

<ul>
  <li>
    <p>create view â€¦</p>
  </li>
  <li>
    <p>drop view â€¦</p>
  </li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- åº“é‡Œ(curry)çš„æ¨ç‰¹</span>
<span class="k">select</span> <span class="n">u</span><span class="p">.</span><span class="n">player</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">content</span> <span class="k">from</span> <span class="n">users</span> <span class="k">as</span> <span class="n">u</span><span class="p">,</span> <span class="n">twitters</span> <span class="k">as</span> <span class="n">t</span> <span class="k">where</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">user_id</span> <span class="k">and</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">-- åˆ›å»ºè§†å›¾</span>

<span class="k">create</span> <span class="k">view</span> <span class="n">curry_twitter</span> <span class="k">as</span> <span class="k">select</span> <span class="n">u</span><span class="p">.</span><span class="n">player</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">content</span> <span class="k">from</span> <span class="n">users</span> <span class="k">as</span> <span class="n">u</span><span class="p">,</span> <span class="n">twitters</span> <span class="k">as</span> <span class="n">t</span> <span class="k">where</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">user_id</span> <span class="k">and</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>


<span class="c1">-- ä½¿ç”¨è§†å›¾,åƒä¸€ä¸ªè™šæ‹Ÿè¡¨,å¯ä»¥å¤§å¹…åº¦ç®€åŒ–ä¹¦å†™çš„SQL.</span>
<span class="c1">-- æˆ‘çš„è§†è§’è¿™ä¸ªä¸ªå¾ˆåƒå‡½æ•°</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">curry_twitter</span><span class="p">;</span>

<span class="c1">-- æŸ¥çœ‹è§†å›¾</span>
<span class="err">\</span><span class="n">dv</span> 


<span class="c1">-- åˆ é™¤è§†å›¾</span>

<span class="k">drop</span> <span class="k">view</span> <span class="n">curry_twitter</span><span class="p">;</span>

</code></pre></div></div>

<p>å¯¹äºè¦ç´¢å¼•çš„å­—æ®µ,è¦å»ºç«‹ç´¢å¼•æ¥æé«˜é€Ÿåº¦.</p>

<p>å¯¹äºå¸¸ç”¨çš„SQL,å¯ä»¥å»ºç«‹è§†å›¾æ¥æ–¹ä¾¿ç¼–ç å’Œç®¡ç†.</p>

<h1 id="åå…­ä½¿ç”¨äº‹åŠ¡">åå…­ã€ä½¿ç”¨äº‹åŠ¡</h1>

<p>æ•°æ®åº“äº‹åŠ¡(Database Transation) æ˜¯æŒ‡ä½œä¸ºä½†ä¸ªé€»è¾‘å·¥ä½œå•å…ƒæ‰§è¡Œçš„ä¸€äº›åˆ—æ“ä½œ.è¦ä¹ˆå®Œå…¨çš„æ‰§è¡Œ,è¦ä¹ˆå®Œå…¨çš„ä¸æ‰§è¡Œ.</p>

<p>ä¸€ä¸ªé€»è¾‘å·¥ä½œå•å…ƒè¦æˆä¸ºåäº”,å¿…é¡»æ»¡è¶³æ‰€è°“çš„ ACID(åŸå­æ€§,ä¸€è‡´æ€§,éš”ç¦»æ€§,æŒä¹…æ€§)å±æ€§/</p>

<p>äº‹åŠ¡æ˜¯æ•°æ®åº“è¿è¡Œçš„é€»è¾‘å·¥ä½œå•ä½.</p>

<p>çŸ¥è¯†ç‚¹:</p>

<p>Postgresqlçš„äº‹åŠ¡ä½¿ç”¨</p>

<ul>
  <li>begin</li>
  <li>commit</li>
  <li>rollback</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">-- ä¾‹å­1</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- å¼€å¯äº‹åŠ¡</span>
<span class="k">begin</span><span class="p">;</span>

<span class="c1">-- è¿™ä¸¤ä¸ªæ“ä½œ,éœ€è¦åŒæ—¶å®Œæˆ</span>
<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">score</span> <span class="o">=</span> <span class="mi">50</span> <span class="k">where</span> <span class="n">player</span> <span class="o">=</span> <span class="s1">'åº“é‡Œ'</span><span class="p">;</span>
<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">score</span> <span class="o">=</span> <span class="mi">60</span> <span class="k">where</span> <span class="n">player</span> <span class="o">=</span> <span class="s1">'å“ˆç™»'</span><span class="p">;</span>

<span class="c1">-- ç„¶åæäº¤</span>
<span class="k">commit</span><span class="p">;</span>


<span class="c1">-- ä¾‹å­2</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">user</span><span class="p">;</span>

<span class="k">begin</span><span class="p">;</span>

<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">scire</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">where</span> <span class="n">player</span> <span class="o">=</span> <span class="s1">'åº“é‡Œ'</span><span class="p">;</span>
<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">where</span> <span class="n">player</span> <span class="o">=</span> <span class="s1">'å“ˆç™»'</span><span class="p">;</span>

<span class="c1">-- å›æ»šåˆ°æ›´æ–°å‰çš„çŠ¶æ€</span>
<span class="k">rollback</span><span class="p">;</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>
</code></pre></div></div>

<p>å¸¸è§„åŸºæœ¬æ“ä½œå®Œç»“ï¼Œæ’’èŠ±~</p>

  </div>

  <footer class="article-footer">

  <!-- <section class="share">
  <a class="share-link" href="" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    Twitter
  </a>
  <a class="share-link" href="" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    Facebook
  </a>
  <a class="share-link" href="" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530'); return false;">
    Google+
  </a> 
</section>
 -->


  <section class="author">
  <div class="authorimage box" style="background: url(/assets/img/Mark24.jpg)"></div>
  <div class="authorinfo box">
    <p>Mark24</p>
    <p class="bio">Everything can Mix.</p>
  </div>
</section>


  </footer>

  <!-- disque è¯„è®ºç³»ç»Ÿ -->
  <!-- 
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname  = 'mark24code';
    var disqus_identifier = '/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/postgresql/%E6%95%B0%E6%8D%AE%E5%BA%93/2021/06/29/Postgresqlç¬”è®°';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

 -->

  <!-- github comments -->
  <script src="https://utteranc.es/client.js" repo="Mark24Code/mark24code.github.io" issue-term="title" theme="github-light"
    crossorigin="anonymous" async>
  </script>

</article>

          </div>
        </div>
      </div>
      <footer class="site-footer">
  <div class="container" style="padding: 10px 32px;">
    <div class="footer left column one-half">
      <section class="small-font">
        Â© 2021
        Powered by <a href="https://github.com/jekyll/jekyll">jekyll</a>
      </section>
    </div>

    <!-- <div class="footer right column one-half">
      <section class="small-font">
        
        <a href="https://github.com/Mark24Code"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span></a>

        
        
      </section>
    </div> -->
  </div>
</footer>

    </div>
    <script>
      (function() {
        var pre = document.getElementsByTagName('pre'),
            pl = pre.length;
        for (var i = 0; i < pl; i++) {
          pre[i].innerHTML = '<span class="line-number"></span>' + pre[i].innerHTML + '<span class="cl"></span>';
          var num = pre[i].innerHTML.split(/\n/).length;
          for (var j = 0; j < (num - 1); j++) {
            var line_num = pre[i].getElementsByTagName('span')[0];
            line_num.innerHTML += '<span>' + (j + 1) + '</span>';
          }
        }
      })();
    </script>
  </body>
</html>
