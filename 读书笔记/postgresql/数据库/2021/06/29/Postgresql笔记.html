<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Postgresql笔记01基本操作</title>
  <meta name="description" content="主要目标熟悉和理解SQL的基本操作。基本功能和逻辑。这部分和其他数据库共通。属于标准SQL范围。学习资料资料视频实战笔记如下，自我验证的笔记。一、开始安装https://www.postgresql.org/download/安装指定版本Ubuntusudo apt install postgresql-9.6安...">
  <!-- evil icon -->

  <link rel="stylesheet" href="/assets/evil-icons.min.css">
  <script src="/assets/evil-icons.min.js"></script>

  <!-- todo: include this into main.css -->

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://mark24code.github.io/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/postgresql/%E6%95%B0%E6%8D%AE%E5%BA%93/2021/06/29/Postgresql%E7%AC%94%E8%AE%B0.html">
  <link rel="alternate" type="application/rss+xml" title="Mark24" href="https://mark24code.github.io/feed.xml">

  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5H3S9CQNF0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5H3S9CQNF0');
</script>


</head>

  <body>
    <div class="page-content">
      <div class="container">
        <div class="three columns">
          <header class="site-header">

  <h2 class="logo"><a href="/">Mark24</a></h2>
  <div class="description">记录灵感、技术、思考</div>

  <div class="nav">
    
    <label for="menu-toggle" class="menu-icon">
        <!--div data-icon="ei-navicon"></div-->
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
    </label>
    <input type="checkbox" id="menu-toggle">

    <div class="site-nav">
      <nav>
        <ul class="page-link">
          <li><a href="/">Home</a></li>
          <li><a href="/posts">Posts</a></li>
          <li><a href="/art">Art</a></li>
          <li><a href="https://speakerdeck.com/mark24code">Sliders</a></li>
          <li><a href="/sites">Sites</a></li>
          <li><a href="/feed.xml">RSS</a></li>
          <li><a href="/about">About</a></li>
        </ul>
      </nav>
    </div>

    <section class="small-font">
      
      <a href="https://github.com/Mark24Code"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span></a>

      
      
    </section>
  </div>
</header>

        </div>

        <div class="nine columns" style="z-index:100;">
          <div class="wrapper">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="artilce_header">
    <h1 class="artilce_title" itemprop="name headline">Postgresql笔记01基本操作</h1>
    <p class="artilce_meta"><time datetime="2021-06-29T23:27:38+08:00" itemprop="datePublished">Jun 29, 2021</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Mark24</span></span></p>
  </header>

  <div class="article-content" itemprop="articleBody">
    <h1 id="主要目标">主要目标</h1>

<p>熟悉和理解SQL的基本操作。基本功能和逻辑。这部分和其他数据库共通。属于标准SQL范围。</p>

<h1 id="学习资料">学习资料</h1>

<p><a href="https://gitee.com/komavideo/LearnPostgreSql">资料</a></p>

<p><a href="https://www.bilibili.com/video/BV17W411P7hn?p=8&amp;spm_id_from=pageDriver">视频</a></p>

<h1 id="实战笔记">实战笔记</h1>

<p>如下，自我验证的笔记。</p>
<h1 id="一开始">一、开始</h1>

<h2 id="安装">安装</h2>

<p>https://www.postgresql.org/download/</p>

<h3 id="安装指定版本">安装指定版本</h3>

<h4 id="ubuntu">Ubuntu</h4>

<p><code class="language-plaintext highlighter-rouge">sudo apt install postgresql-9.6</code></p>

<p>安装成功提示：</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
成功。您现在可以用下面的命令开启数据库服务器：

/usr/lib/postgresql/9.6/bin/pg_ctl -D /var/lib/postgresql/9.6/main -l logfile start

</code></pre></div></div>

<h4 id="mac">Mac</h4>

<p><code class="language-plaintext highlighter-rouge">brew install postgresql@9.6</code></p>

<p>参考 <a href="https://formulae.brew.sh/formula/postgresql">https://formulae.brew.sh/formula/postgresql</a></p>

<p>安装成功提示</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>If builds of PostgreSQL 9 are failing and you have version 8.x installed,
you may need to remove the previous version first. See:
  https://github.com/Homebrew/legacy-homebrew/issues/2510

This formula has created a default database cluster with:
  initdb /usr/local/var/postgresql@9.6
For more details, read:
  https://www.postgresql.org/docs/9/app-initdb.html

postgresql@9.6 is keg-only, which means it was not symlinked into /usr/local,
because this is an alternate version of another formula.

If you need to have postgresql@9.6 first in your PATH, run:
  echo 'export PATH="/usr/local/opt/postgresql@9.6/bin:$PATH"' &gt;&gt; ~/.zshrc

For compilers to find postgresql@9.6 you may need to set:
  export LDFLAGS="-L/usr/local/opt/postgresql@9.6/lib"
  export CPPFLAGS="-I/usr/local/opt/postgresql@9.6/include"

For pkg-config to find postgresql@9.6 you may need to set:
  export PKG_CONFIG_PATH="/usr/local/opt/postgresql@9.6/lib/pkgconfig"


To have launchd start postgresql@9.6 now and restart at login:
  brew services start postgresql@9.6
Or, if you don't want/need a background service you can just run:
  pg_ctl -D /usr/local/var/postgresql@9.6 start
==&gt; Summary
🍺  /usr/local/Cellar/postgresql@9.6/9.6.22: 1,651 files, 24.8MB

</code></pre></div></div>

<p>仔细看这里需要执行</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo 'export PATH="/usr/local/opt/postgresql@9.6/bin:$PATH"' &gt;&gt; ~/.zshrc
</code></pre></div></div>

<h3 id="卸载">卸载</h3>

<p>Ubuntu</p>

<p><code class="language-plaintext highlighter-rouge">sudo apt-get --purge remove postgresql\*</code></p>

<p>Mac</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew uninstall postgresql
</code></pre></div></div>

<h3 id="启动服务">启动服务</h3>

<p>Ubuntu</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo service postgresql start 
sudo service postgresql restart 
</code></pre></div></div>

<p>Mac</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew services start postgresql@9.6
</code></pre></div></div>

<h3 id="查看状态">查看状态</h3>

<p>Ubuntu</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pg_lsclusters
</code></pre></div></div>

<h2 id="1修改psql的密码">1.修改psql的密码</h2>

<p>想要进入Postgresql。在Ubuntu中 Postgresql会创建一个默认用户postgres 并且密码随机。所以需要修改密码。</p>

<p>1） 登录Postgresql</p>

<p><code class="language-plaintext highlighter-rouge">sudo -u postgres psql</code></p>

<p>2） 修改postgres的密码</p>

<p><code class="language-plaintext highlighter-rouge">ALTER USER postgres WITH PASSWORD 'postgres';</code></p>

<p>这样外部才能正常使用比如pgAdmin登录进去。</p>

<h2 id="2修改linux中posgres的密码">2.修改Linux中posgres的密码</h2>

<p>PostgreSQL会创建一个默认的Linux用户 postgres，修改系统中这个用户的密码</p>

<p>1） 删除密码</p>

<p><code class="language-plaintext highlighter-rouge">sudo passwd -d postgres</code></p>

<p>2） 设置密码</p>

<p><code class="language-plaintext highlighter-rouge">sudo -u postgres passwd</code></p>

<p>遵循系统提示就好了。</p>

<h3 id="ubuntu下进入-psql超级用户操作">ubuntu下进入 psql超级用户操作</h3>

<p>1) 以Postgresql建立的 postgres用户进入 psql</p>

<p><code class="language-plaintext highlighter-rouge">sudo -u postgres psql</code></p>

<p>2） 查看所有数据库</p>

<p><code class="language-plaintext highlighter-rouge">\l</code></p>

<p>3) 退出 数据库界面</p>

<p><code class="language-plaintext highlighter-rouge">\q</code></p>

<p>4) 进入 test  数据库</p>

<p><code class="language-plaintext highlighter-rouge">\c test</code></p>

<p>5) 列出所有表</p>

<p><code class="language-plaintext highlighter-rouge">\d</code></p>

<p>6) 列出 test下 tb1 信息</p>

<p><code class="language-plaintext highlighter-rouge">\d tb1</code></p>

<h1 id="二简单使用">二、简单使用</h1>

<h2 id="1默认建立了一个用户-postgres">1.默认建立了一个用户 postgres</h2>

<p>切换到用户才能使用。默认账户也是系统管理员</p>

<h3 id="进入特定用户">进入特定用户</h3>

<p><code class="language-plaintext highlighter-rouge">sudo su postgres</code></p>

<blockquote>
  <p>Mac 用户是 brew安装的，直接使用好了。</p>
</blockquote>

<p>在用户的全局添加了一些全局的shell命令，比如建立数据库 createdb，dropdb,  postgresql的命令行程序 psql</p>

<h3 id="查看版本">查看版本</h3>

<p><code class="language-plaintext highlighter-rouge">psql --version</code></p>

<h3 id="查看数据库列表">查看数据库列表</h3>

<p><code class="language-plaintext highlighter-rouge">psql -l</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
postgres@ubuntu:/home/mark24/LabSpace/sql-test$ psql -l
                                     数据库列表
   名称    |  拥有者  | 字元编码 |  校对规则   |    Ctype    |       存取权限        
-----------+----------+----------+-------------+-------------+-----------------------
 markblog  | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 |
 postgres  | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 |
 template0 | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 | =c/postgres          +
           |          |          |             |             | postgres=CTc/postgres
 template1 | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 | =c/postgres          +
           |          |          |             |             | postgres=CTc/postgres
(4 行记录)
</code></pre></div></div>

<h3 id="创建数据库">创建数据库</h3>

<p><code class="language-plaintext highlighter-rouge">createdb  &lt;db name&gt;</code></p>

<h3 id="删除数据库">删除数据库</h3>

<p><code class="language-plaintext highlighter-rouge">dropdb &lt;db name&gt;</code></p>

<h3 id="进入数据库">进入数据库</h3>

<p><code class="language-plaintext highlighter-rouge">psql &lt;db name&gt;</code></p>

<p>进入数据库界面会换一个样子:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgres@ubuntu:/home/mark24/LabSpace/sql-test$ psql markblog
psql (9.6.22)
输入 "help" 来获取帮助信息.

markblog=#
</code></pre></div></div>

<p>进入数据库之后，可以用一些简单缩写命令</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>markblog=# help
您正在使用psql, 这是一种用于访问PostgreSQL的命令行界面
键入： \copyright 显示发行条款
       \h 显示 SQL 命令的说明
       \? 显示 pgsql 命令的说明
       \g 或者以分号(;)结尾以执行查询
       \q 退出



\h  可以加上SQL关键字查看关键字用法，什么都不加，打开关键字列表
\?  加上命令可以看命令解释没什么都不加，可以看到所有的命令列表



</code></pre></div></div>

<p>两个系统提供的函数。进入DB之后</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>select  version();
select now();
</code></pre></div></div>

<h1 id="三操作数据表">三、操作数据表</h1>

<h2 id="1建立一个数据表">1.建立一个数据表</h2>

<p><code class="language-plaintext highlighter-rouge">create table</code></p>

<p>例如</p>

<p><code class="language-plaintext highlighter-rouge">CREATE TABLE postes ( title varchar(255), content text);</code></p>

<p><code class="language-plaintext highlighter-rouge">\dt</code> 可以通过这个命令列出所有的表查看</p>

<h1 id="2删除一个数据表">2.删除一个数据表</h1>

<p><code class="language-plaintext highlighter-rouge">drop table</code></p>

<p><code class="language-plaintext highlighter-rouge">drop table &lt;table name&gt;;</code></p>

<h1 id="3使用sql-文件建立表格">3.使用sql 文件建立表格</h1>

<p>1) 推出数据库模式</p>

<p>2) vim 编辑文件 比如 db.sql</p>

<blockquote>
  <p>db.sql</p>
  <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">postes</span> <span class="p">(</span> <span class="n">title</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">content</span> <span class="nb">text</span><span class="p">);</span>
</code></pre></div>  </div>
</blockquote>

<p>3) 进入 database 即  posql <database name=""></database></p>

<p>i命令导入了sql文件执行</p>

<p><code class="language-plaintext highlighter-rouge">\i  db.sql</code></p>

<p>4) 变更表名</p>

<p><code class="language-plaintext highlighter-rouge">alter table &lt;old table name&gt; rename to &lt;new table name&gt;;</code></p>

<p>5) 列出所有的表，查看</p>

<p><code class="language-plaintext highlighter-rouge">\dt</code></p>

<p>6) 查看表的描述</p>

<p><code class="language-plaintext highlighter-rouge">\d  &lt;table name&gt;</code></p>

<p>7) 删除一个表</p>

<p><code class="language-plaintext highlighter-rouge">DROP TABLE &lt;table name&gt;;</code></p>

<h1 id="四-字段类型">四、 字段类型</h1>

<p>仅仅列出工作中比较常用的：</p>

<h2 id="数字">数字</h2>

<ul>
  <li>
    <p>integer(int)</p>

    <p>四个字节</p>
  </li>
  <li>
    <p>real</p>

    <p>四个字节，浮点数</p>
  </li>
  <li>
    <p>serial</p>

    <p>序列，用于自增ID</p>
  </li>
</ul>

<h2 id="文字">文字</h2>

<ul>
  <li>
    <p>char</p>

    <p>定长字符。比如10个字符空间，赋值2个，其余8个留空</p>
  </li>
  <li>
    <p>varchar
  常用。变长。比如10个字符，赋值2个就是2个。</p>
  </li>
  <li>
    <p>text</p>

    <p>大文本</p>
  </li>
</ul>

<h2 id="布尔">布尔</h2>

<ul>
  <li>boolean</li>
</ul>

<h1 id="日期">日期</h1>

<ul>
  <li>
    <p>date</p>

    <p>年月日</p>
  </li>
  <li>
    <p>time</p>

    <p>时分秒</p>
  </li>
  <li>
    <p>timestamp</p>

    <p>年月日+时分秒</p>
  </li>
</ul>

<h1 id="特色类型">特色类型</h1>

<ul>
  <li>
    <p>Array</p>
  </li>
  <li>
    <p>网络地址型（inet）</p>
  </li>
  <li>
    <p>JSON型</p>
  </li>
  <li>
    <p>XML型</p>
  </li>
</ul>

<p>全部的数据类型可以参考官方文档 <a href="https://www.postgresql.org/docs/9.6/datatype.html">Postgresql 9.6 datatype</a></p>

<h1 id="五约束">五、约束</h1>

<p>对字段的一些限制就是约束。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">posts</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">serial</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
  <span class="n">title</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">content</span> <span class="nb">text</span> <span class="k">check</span><span class="p">(</span><span class="k">length</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">),</span>
  <span class="n">if_draft</span> <span class="nb">boolean</span> <span class="k">default</span> <span class="k">TRUE</span><span class="p">,</span>
  <span class="n">is_del</span> <span class="nb">boolean</span> <span class="k">default</span> <span class="k">FALSE</span><span class="p">,</span>
  <span class="n">created_date</span> <span class="nb">timestamp</span> <span class="k">default</span> <span class="s1">'now'</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="约束举例子解释">约束举例子解释</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>not null 不能为空

unique 在所有数据中必须唯一

check 字段设置条件

default  默认值

primary key (not null, unique)  主键，自带两个属性，非空，不重复
</code></pre></div></div>

<h2 id="代码分析">代码分析</h2>

<ul>
  <li>
    <p>ID作为主键</p>

    <p>单一ID做主键方便增删查改
primary key  是一个关键字，标记是主键（暗含了，not null 且 unique）
serial 是自增类型</p>
  </li>
  <li>
    <p>标题</p>

    <p>varchar 变长，最长255，非空</p>
  </li>
  <li>
    <p>内容</p>

    <p>内容长度必须 &gt;8</p>
  </li>
  <li>
    <p>草稿标记</p>

    <p>默认是草稿</p>
  </li>
  <li>
    <p>软删除标记</p>

    <p>默认是不删除</p>

    <p>推荐做逻辑删除。</p>
  </li>
  <li>
    <p>创建时间</p>
  </li>
</ul>

<h1 id="六insert语句">六、Insert语句</h1>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">table</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="p">...)</span> <span class="k">values</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">...)</span>
</code></pre></div></div>

<h3 id="sql-实验">sql 实验</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 1. 约束便捷</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">posts</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>

<span class="c1">-- ERROR:  new row for relation "posts" violates check constraint "posts_content_check"</span>
<span class="c1">-- DETAIL:  Failing row contains (2, , , t, f, 2021-06-30 13:34:41.442131).</span>

<span class="c1">-- 2. 标题null</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">posts</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>

<span class="c1">-- ERROR:  null value in column "title" violates not-null constraint</span>
<span class="c1">-- DETAIL:  Failing row contains (3, null, , t, f, 2021-06-30 13:34:41.442131).</span>

<span class="c1">-- 3. 全对的情况</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">posts</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'title'</span> <span class="p">,</span> <span class="s1">'content ABC'</span><span class="p">);</span>

<span class="c1">-- markblog=# insert into posts (title, content) values ('title' , 'content ABC');</span>
<span class="c1">-- INSERT 0 1</span>

<span class="c1">-- 插入成功,查看插入结果，需要用select。 想想一下 select就像在excel中选择特定的列，然后会返回特定的行。</span>

<span class="k">select</span>  <span class="o">*</span> <span class="k">from</span>  <span class="n">posts</span><span class="p">;</span>
<span class="c1">--  id | title |   content   | if_draft | is_del |        created_date</span>
<span class="c1">-- ----+-------+-------------+----------+--------+----------------------------</span>
<span class="c1">--   4 | title | content ABC | t        | f      | 2021-06-30 13:34:41.442131</span>
<span class="c1">-- (1 row)</span>

</code></pre></div></div>

<blockquote>
  <p>理解 select，查看插入结果，需要用select。 想想一下 select就像在excel中选择特定的列，然后会返回特定的行。</p>
</blockquote>

<h1 id="七select-语句">七、Select 语句</h1>

<p>select的基本使用方法。</p>

<p>实战部分，先要准备数据。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">users</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">serial</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
  <span class="n">player</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">score</span> <span class="nb">real</span><span class="p">,</span>
  <span class="n">team</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">);</span>


<span class="k">insert</span> <span class="k">into</span> <span class="n">users</span> <span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">team</span><span class="p">)</span> 
<span class="k">values</span>
<span class="p">(</span><span class="s1">'tom'</span><span class="p">,</span> <span class="mi">28</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'A'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'nick'</span><span class="p">,</span> <span class="mi">98</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'B'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'mark'</span><span class="p">,</span> <span class="mi">30</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'C'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'linda'</span><span class="p">,</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'D'</span><span class="p">);</span>

</code></pre></div></div>

<p>SQL实战</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 1. 拿出所有数据</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">--  id | player | score | team</span>
<span class="c1">-- ----+--------+-------+------</span>
<span class="c1">--   1 | tom    |  28.4 | A</span>
<span class="c1">--   2 | nick   |  98.4 | B</span>
<span class="c1">--   3 | mark   |  30.4 | C</span>
<span class="c1">--   4 | linda  |   100 | D</span>
<span class="c1">-- (4 rows)</span>

<span class="c1">-- 1.1 \x 字段比较多的时候，可以通过增加 \x 返回让字段更清晰。 \x 是一个开关。上下文调用呈现 toggle开关效果</span>

<span class="err">\</span><span class="n">x</span>

<span class="c1">-- markblog=# \x</span>
<span class="c1">-- Expanded display is on.</span>
<span class="c1">-- markblog=# select * from users;</span>
<span class="c1">-- -[ RECORD 1 ]-</span>
<span class="c1">-- id     | 1</span>
<span class="c1">-- player | tom</span>
<span class="c1">-- score  | 28.4</span>
<span class="c1">-- team   | A</span>
<span class="c1">-- -[ RECORD 2 ]-</span>
<span class="c1">-- id     | 2</span>
<span class="c1">-- player | nick</span>
<span class="c1">-- score  | 98.4</span>
<span class="c1">-- team   | B</span>
<span class="c1">-- -[ RECORD 3 ]-</span>
<span class="c1">-- id     | 3</span>
<span class="c1">-- player | mark</span>
<span class="c1">-- score  | 30.4</span>
<span class="c1">-- team   | C</span>
<span class="c1">-- -[ RECORD 4 ]-</span>
<span class="c1">-- id     | 4</span>
<span class="c1">-- player | linda</span>
<span class="c1">-- score  | 100</span>
<span class="c1">-- team   | D</span>


<span class="c1">-- 再次运行 \x 可以关闭</span>

<span class="c1">-- 2. 选出目标字段</span>

<span class="k">select</span> <span class="n">player</span><span class="p">,</span> <span class="n">score</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>
</code></pre></div></div>

<h1 id="八where语句">八、where语句</h1>

<p>where语句基本使用。配合提取、更新删除。用于过滤条件。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">;</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="k">and</span> <span class="n">score</span> <span class="o">&lt;</span><span class="mi">30</span> <span class="p">;</span>

<span class="c1">-- 等于</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">team</span> <span class="o">=</span> <span class="s1">'A'</span><span class="p">;</span>

<span class="c1">-- 不等于</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">team</span> <span class="o">!=</span> <span class="s1">'A'</span><span class="p">;</span>

<span class="c1">-- %表示后面所有数据</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">player</span> <span class="k">like</span> <span class="s1">'t%'</span><span class="p">;</span>

<span class="c1">-- _表示一个字符</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">player</span> <span class="k">like</span> <span class="s1">'t_'</span><span class="p">;</span>



</code></pre></div></div>

<p>实验结果</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># \x</span>
Expanded display is off.
<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users;</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  1 | tom    |  28.4 | A
  2 | nick   |  98.4 | B
  3 | mark   |  30.4 | C
  4 | linda  |   100 | D
<span class="o">(</span>4 rows<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where score &gt; 20;</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  1 | tom    |  28.4 | A
  2 | nick   |  98.4 | B
  3 | mark   |  30.4 | C
  4 | linda  |   100 | D
<span class="o">(</span>4 rows<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where score &gt; 50;</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  2 | nick   |  98.4 | B
  4 | linda  |   100 | D
<span class="o">(</span>2 rows<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where score &gt; 20 and score &lt;30 ;</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  1 | tom    |  28.4 | A
<span class="o">(</span>1 row<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where team = 'A';</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  1 | tom    |  28.4 | A
<span class="o">(</span>1 row<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where team != 'A';</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  2 | nick   |  98.4 | B
  3 | mark   |  30.4 | C
  4 | linda  |   100 | D
<span class="o">(</span>3 rows<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where player like 't%';</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
  1 | tom    |  28.4 | A
<span class="o">(</span>1 row<span class="o">)</span>

<span class="nv">markblog</span><span class="o">=</span><span class="c"># select * from users where player like 't_';</span>
 <span class="nb">id</span> | player | score | team
<span class="nt">----</span>+--------+-------+------
<span class="o">(</span>0 rows<span class="o">)</span>


</code></pre></div></div>

<h1 id="九数据抽出选项">九、数据抽出选项</h1>

<p>select语句在抽出数据时，可以对语句设置更多的选项，已得到想要的数据。</p>

<ul>
  <li>order by</li>
  <li>limit</li>
  <li>offset</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 升序：从小到大排序 （默认）</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">score</span> <span class="k">asc</span><span class="p">;</span>
<span class="c1">-- 降序：从大到小排序</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">score</span> <span class="k">desc</span><span class="p">;</span>
<span class="c1">-- 升序</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span><span class="p">;</span>
<span class="c1">-- 先按照团队升序，在按照分数升序</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span><span class="p">,</span> <span class="n">score</span><span class="p">;</span>
<span class="c1">-- 团队升序，分数降序</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span><span class="p">,</span> <span class="n">score</span> <span class="k">desc</span><span class="p">;</span>
<span class="c1">-- 团队降序，分数降序</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span> <span class="k">desc</span><span class="p">,</span> <span class="n">score</span> <span class="k">desc</span><span class="p">;</span>
<span class="c1">-- 团队，获得前三， 默认offset是0</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span> <span class="k">desc</span> <span class="k">limit</span> <span class="mi">3</span><span class="p">;</span>
<span class="c1">-- 从第一名后面，取三个 即 2，3，4</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span> <span class="k">desc</span> <span class="k">limit</span> <span class="mi">3</span> <span class="k">offset</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">-- limit和offset可以完成分页操作</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">team</span> <span class="k">desc</span> <span class="k">limit</span> <span class="mi">3</span> <span class="k">offset</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div></div>

<h1 id="十统计抽出选项">十、统计抽出选项</h1>

<ul>
  <li>distinct  过滤重复数据</li>
  <li>sum 求和</li>
  <li>max/min 最大值/最小值</li>
  <li>group by / having   对集合进行分组然后计算</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">-- 去重</span>
 <span class="k">select</span> <span class="k">distinct</span> <span class="n">team</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- 进行求和</span>
 <span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- 求最高</span>
<span class="c1">-- 这里使用函数，select &lt;分组ID&gt;, min(score) from users; 将是无效语句，这是一个汇总语句，需要跟上 group by </span>
<span class="c1">-- select &lt;分组ID&gt;, min(score) from users group by &lt;分组ID&gt;; 才是有效的</span>
 <span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

 <span class="k">select</span> <span class="k">min</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- 表中得分最多 的 队员信息</span>
 <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">score</span> <span class="o">=</span> <span class="p">(</span><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">);</span>
 <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">score</span> <span class="o">=</span> <span class="p">(</span><span class="k">select</span> <span class="k">min</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">);</span>

 <span class="k">select</span> <span class="n">team</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span> <span class="k">group</span> <span class="k">by</span> <span class="n">team</span><span class="p">;</span>

<span class="c1">--  having是分组中的where，就是对分组数据的过滤。</span>
 <span class="k">select</span> <span class="n">team</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span> <span class="k">group</span> <span class="k">by</span> <span class="n">team</span> <span class="k">having</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">;</span>

<span class="c1">--  max(score) 其实就是一个独立字段了。 这里 as 未生效</span>
 <span class="k">select</span> <span class="n">team</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span> <span class="k">group</span> <span class="k">by</span> <span class="n">team</span> <span class="k">having</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">25</span> <span class="k">order</span> <span class="k">by</span> <span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">);</span>
</code></pre></div></div>

<h1 id="十一方便函数">十一、方便函数</h1>

<p>知识点</p>

<ul>
  <li>length</li>
  <li>concat</li>
  <li>alias</li>
  <li>substring 切割字符串</li>
  <li>random</li>
</ul>

<p><a href="https://www.postgresql.org/docs/9.6/functions.html">更多参考 https://www.postgresql.org/docs/9.6/functions.html</a></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 获得player的长度</span>
<span class="k">select</span> <span class="n">player</span><span class="p">,</span> <span class="k">length</span><span class="p">(</span><span class="n">player</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="k">select</span> <span class="n">player</span><span class="p">,</span> <span class="n">concat</span><span class="p">(</span><span class="n">player</span><span class="p">,</span><span class="s1">'/'</span><span class="p">,</span><span class="n">team</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- select player, count(player) from users; 这句不能工作。函数应用场景不同</span>


<span class="c1">-- 起一个别名</span>
<span class="c1">-- 警告⚠：一定要是双引号</span>
<span class="k">select</span> <span class="n">player</span><span class="p">,</span> <span class="n">concat</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">,</span> <span class="n">team</span><span class="p">)</span> <span class="k">as</span> <span class="nv">"球员信息"</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>


<span class="c1">-- 如果不加as 字段名字是函数名</span>

<span class="c1">-- testblog=# select player, concat(player, '/', team) from users;</span>
<span class="c1">--  player |  concat  </span>
<span class="c1">-- --------+----------</span>
<span class="c1">--  tom    | tom/A</span>
<span class="c1">--  nick   | nick/B</span>
<span class="c1">--  mark24 | mark24/C</span>
<span class="c1">--  m-pl   | m-pl/C</span>
<span class="c1">--  kk     | kk/C</span>
<span class="c1">--  SSark  | SSark/C</span>
<span class="c1">--  dddk   | dddk/C</span>
<span class="c1">--  linda  | linda/D</span>
<span class="c1">-- (8 行记录)</span>

<span class="c1">-- 第一个字节开始切，切一个</span>
<span class="k">select</span> <span class="k">substring</span><span class="p">(</span><span class="n">team</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="nv">"球队首文字"</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- '我' 单引号作为字符串，双引号作为变量识别</span>
<span class="k">select</span> <span class="n">concat</span><span class="p">(</span><span class="s1">'我'</span><span class="p">,</span><span class="k">substring</span><span class="p">(</span><span class="n">team</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="k">as</span> <span class="nv">"球队首文字"</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="k">select</span> <span class="n">random</span><span class="p">();</span>

<span class="c1">-- 随机排序，抽奖的时候可以用</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">random</span><span class="p">();</span>

<span class="c1">-- 随即选择一个用户</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">order</span> <span class="k">by</span> <span class="n">random</span><span class="p">()</span> <span class="k">limit</span> <span class="k">by</span> <span class="mi">1</span><span class="p">;</span>

</code></pre></div></div>

<h1 id="十二更新和删除">十二、更新和删除</h1>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">update</span> <span class="p">[</span><span class="k">table</span> <span class="n">name</span><span class="p">]</span> <span class="k">set</span> <span class="p">[</span><span class="n">field</span><span class="o">=</span><span class="n">newValue</span><span class="p">,....]</span>  <span class="k">where</span> <span class="p">...</span>


<span class="c1">-- 这个是物理删除</span>
<span class="k">delete</span> <span class="k">from</span> <span class="p">[</span><span class="k">table</span> <span class="n">name</span><span class="p">]</span> <span class="k">where</span> <span class="p">....</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">-- 更新属性</span>
<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">score</span> <span class="o">=</span> <span class="mi">29</span><span class="p">.</span><span class="mi">1</span> <span class="k">where</span> <span class="n">player</span> <span class="o">=</span> <span class="s1">'mark'</span><span class="p">;</span>

<span class="c1">-- 属性自+1</span>
<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">where</span> <span class="n">team</span> <span class="o">=</span> <span class="s1">'A'</span><span class="p">;</span>


<span class="c1">-- 给定范围</span>
<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">+</span> <span class="mi">100</span> <span class="k">where</span> <span class="n">team</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'A'</span><span class="p">,</span> <span class="s1">'B'</span><span class="p">);</span>


<span class="c1">-- 条件物理删除</span>
<span class="k">delete</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">;</span>

</code></pre></div></div>

<h1 id="十三更新表结构">十三、更新表结构</h1>

<p>知识点</p>

<ul>
  <li>alter table [table name] …</li>
</ul>

<p>创建索引</p>
<ul>
  <li>create index …
删除索引</li>
  <li>drop index …</li>
</ul>

<p>对需要的字段增加索引查询的速度会提升。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 查看users表结构</span>
<span class="err">\</span><span class="n">d</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- 给users表新增字段</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">users</span> <span class="k">add</span> <span class="n">fullname</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>

<span class="c1">-- 删除字段</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">users</span> <span class="k">drop</span> <span class="n">fullname</span><span class="p">;</span>

<span class="c1">-- 更改字段名</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">users</span> <span class="k">rename</span> <span class="n">player</span> <span class="k">to</span> <span class="n">nba_player</span><span class="p">;</span>

<span class="c1">-- 更改表中某个字段的类型</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">users</span> <span class="k">alter</span> <span class="n">nba_player</span> <span class="k">type</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

<span class="c1">-- 用 users(nba_player) 的字段，创建索引，索引名字为 nba_player_index</span>
<span class="k">create</span> <span class="k">index</span> <span class="n">nba_player_index</span> <span class="k">on</span> <span class="n">users</span><span class="p">(</span><span class="n">nba_player</span><span class="p">);</span>


<span class="c1">-- 删除制定索引</span>
<span class="k">drop</span> <span class="k">index</span> <span class="n">nba_player_index</span><span class="p">;</span>
</code></pre></div></div>

<h1 id="十四操作多个表">十四、操作多个表</h1>

<p>表结合查询的基础知识</p>

<p>数据准备,请清空之前的数据</p>

<p>reinit.sql</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">users</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">serial</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="n">player</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">score</span> <span class="nb">real</span><span class="p">,</span>
    <span class="n">team</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">);</span>


<span class="k">insert</span> <span class="k">into</span> <span class="n">users</span> <span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">team</span><span class="p">)</span> <span class="k">values</span>
<span class="p">(</span><span class="s1">'库里'</span><span class="p">,</span> <span class="mi">28</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'勇士'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'哈登'</span><span class="p">,</span> <span class="mi">30</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'火箭'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'阿杜'</span><span class="p">,</span> <span class="mi">25</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">'勇士'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'阿詹'</span><span class="p">,</span> <span class="mi">27</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span> <span class="s1">'骑士'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'神龟'</span><span class="p">,</span> <span class="mi">31</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'雷霆'</span><span class="p">),</span>
<span class="p">(</span><span class="s1">'白边'</span><span class="p">,</span> <span class="mi">19</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span> <span class="s1">'热火'</span><span class="p">);</span>

<span class="c1">-- 通过user_id 进行逻辑关联</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">twitters</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">serial</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="n">user_id</span> <span class="nb">integer</span><span class="p">,</span>
    <span class="n">content</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">twitters</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span> <span class="k">values</span> 
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'今天有时大胜'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'我得了60分'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'获胜赞不怕'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'明年在来'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'我20+'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'走了。'</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">twitters</span><span class="p">;</span>


<span class="c1">-- 组合两张表的数据</span>
<span class="k">select</span> <span class="n">users</span><span class="p">.</span><span class="n">player</span><span class="p">,</span> <span class="n">twitters</span><span class="p">.</span><span class="n">content</span> <span class="k">from</span> <span class="n">users</span><span class="p">,</span> <span class="n">twitters</span> <span class="k">where</span> <span class="n">users</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">twitters</span><span class="p">.</span><span class="n">user_id</span><span class="p">;</span>

<span class="c1">-- 输出结果</span>
<span class="c1">-- marktest=# select users.player, twitters.content from users, twitters where users.id = twitters.user_id;</span>
<span class="c1">--  player |   content    </span>
<span class="c1">-- --------+--------------</span>
<span class="c1">--  库里   | 今天有时大胜</span>
<span class="c1">--  哈登   | 我得了60分</span>
<span class="c1">--  阿杜   | 获胜赞不怕</span>
<span class="c1">--  阿詹   | 明年在来</span>
<span class="c1">--  神龟   | 我20+</span>
<span class="c1">--  库里   | 走了。</span>
<span class="c1">-- (6 行记录)</span>



<span class="c1">-- 获得所有的球员</span>
<span class="c1">-- 使用 as 进行别名缩短 sql，注意的是这里是from后面标记了。然后其他部分可以使用。其实from是最先执行的。</span>
<span class="c1">-- select和where涉及到两个表,通过一个Id实现关联 - 这就是表关联</span>
<span class="k">select</span> <span class="n">u</span><span class="p">.</span><span class="n">player</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">content</span> <span class="k">from</span> <span class="n">users</span> <span class="k">as</span> <span class="n">u</span><span class="p">,</span> <span class="n">twitters</span> <span class="k">as</span> <span class="n">t</span> <span class="k">where</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">user_id</span><span class="p">;</span>

<span class="c1">-- 筛选一个用户id=1的</span>
<span class="k">select</span> <span class="n">u</span><span class="p">.</span><span class="n">player</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">content</span> <span class="k">from</span> <span class="n">users</span> <span class="k">as</span> <span class="n">u</span><span class="p">,</span> <span class="n">twitters</span> <span class="k">as</span> <span class="n">t</span> <span class="k">where</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">user_id</span> <span class="k">and</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<h1 id="十五使用视图">十五、使用视图</h1>

<p>概念:视图(View) 是从一个或多个表导出的对象,视图与表不同,视图是一个虚表,即视图所对应的数据不进行实际存储.数据库只存储视图的定义,在对视图的数据进行操作时,系统根据视图的定义去操作与视图相关联的基本表.</p>

<p>白话解释:</p>

<p>视图就是一个select语句,把业务中常用的select语句简化成一个类似表的对象,便于简单的读取和开发。</p>

<p>相当于一个逻辑表。</p>

<p>知识点:</p>

<p>使用数据库视图</p>

<ul>
  <li>
    <p>create view …</p>
  </li>
  <li>
    <p>drop view …</p>
  </li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 库里(curry)的推特</span>
<span class="k">select</span> <span class="n">u</span><span class="p">.</span><span class="n">player</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">content</span> <span class="k">from</span> <span class="n">users</span> <span class="k">as</span> <span class="n">u</span><span class="p">,</span> <span class="n">twitters</span> <span class="k">as</span> <span class="n">t</span> <span class="k">where</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">user_id</span> <span class="k">and</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">-- 创建视图</span>

<span class="k">create</span> <span class="k">view</span> <span class="n">curry_twitter</span> <span class="k">as</span> <span class="k">select</span> <span class="n">u</span><span class="p">.</span><span class="n">player</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">content</span> <span class="k">from</span> <span class="n">users</span> <span class="k">as</span> <span class="n">u</span><span class="p">,</span> <span class="n">twitters</span> <span class="k">as</span> <span class="n">t</span> <span class="k">where</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">user_id</span> <span class="k">and</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>


<span class="c1">-- 使用视图,像一个虚拟表,可以大幅度简化书写的SQL.</span>
<span class="c1">-- 我的视角这个个很像函数</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">curry_twitter</span><span class="p">;</span>

<span class="c1">-- 查看视图</span>
<span class="err">\</span><span class="n">dv</span> 


<span class="c1">-- 删除视图</span>

<span class="k">drop</span> <span class="k">view</span> <span class="n">curry_twitter</span><span class="p">;</span>

</code></pre></div></div>

<p>对于要索引的字段,要建立索引来提高速度.</p>

<p>对于常用的SQL,可以建立视图来方便编码和管理.</p>

<h1 id="十六使用事务">十六、使用事务</h1>

<p>数据库事务(Database Transation) 是指作为但个逻辑工作单元执行的一些列操作.要么完全的执行,要么完全的不执行.</p>

<p>一个逻辑工作单元要成为十五,必须满足所谓的 ACID(原子性,一致性,隔离性,持久性)属性/</p>

<p>事务是数据库运行的逻辑工作单位.</p>

<p>知识点:</p>

<p>Postgresql的事务使用</p>

<ul>
  <li>begin</li>
  <li>commit</li>
  <li>rollback</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">-- 例子1</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>

<span class="c1">-- 开启事务</span>
<span class="k">begin</span><span class="p">;</span>

<span class="c1">-- 这两个操作,需要同时完成</span>
<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">score</span> <span class="o">=</span> <span class="mi">50</span> <span class="k">where</span> <span class="n">player</span> <span class="o">=</span> <span class="s1">'库里'</span><span class="p">;</span>
<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">score</span> <span class="o">=</span> <span class="mi">60</span> <span class="k">where</span> <span class="n">player</span> <span class="o">=</span> <span class="s1">'哈登'</span><span class="p">;</span>

<span class="c1">-- 然后提交</span>
<span class="k">commit</span><span class="p">;</span>


<span class="c1">-- 例子2</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">user</span><span class="p">;</span>

<span class="k">begin</span><span class="p">;</span>

<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">scire</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">where</span> <span class="n">player</span> <span class="o">=</span> <span class="s1">'库里'</span><span class="p">;</span>
<span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">where</span> <span class="n">player</span> <span class="o">=</span> <span class="s1">'哈登'</span><span class="p">;</span>

<span class="c1">-- 回滚到更新前的状态</span>
<span class="k">rollback</span><span class="p">;</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>
</code></pre></div></div>

<p>常规基本操作完结，撒花~</p>

  </div>

  <footer class="article-footer">

  <!-- <section class="share">
  <a class="share-link" href="" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    Twitter
  </a>
  <a class="share-link" href="" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    Facebook
  </a>
  <a class="share-link" href="" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530'); return false;">
    Google+
  </a> 
</section>
 -->


  <section class="author">
  <div class="authorimage box" style="background: url(/assets/img/Mark24.jpg)"></div>
  <div class="authorinfo box">
    <p>Mark24</p>
    <p class="bio">Everything can Mix.</p>
  </div>
</section>


  </footer>

  <!-- disque 评论系统 -->
  <!-- 
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname  = 'mark24code';
    var disqus_identifier = '/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/postgresql/%E6%95%B0%E6%8D%AE%E5%BA%93/2021/06/29/Postgresql笔记';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

 -->

  <!-- github comments -->
  <script src="https://utteranc.es/client.js" repo="Mark24Code/mark24code.github.io" issue-term="title" theme="github-light"
    crossorigin="anonymous" async>
  </script>

</article>

          </div>
        </div>
      </div>
      <footer class="site-footer">
  <div class="container" style="padding: 10px 32px;">
    <div class="footer left column one-half">
      <section class="small-font">
        © 2021
        Powered by <a href="https://github.com/jekyll/jekyll">jekyll</a>
      </section>
    </div>

    <!-- <div class="footer right column one-half">
      <section class="small-font">
        
        <a href="https://github.com/Mark24Code"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span></a>

        
        
      </section>
    </div> -->
  </div>
</footer>

    </div>
    <script>
      (function() {
        var pre = document.getElementsByTagName('pre'),
            pl = pre.length;
        for (var i = 0; i < pl; i++) {
          pre[i].innerHTML = '<span class="line-number"></span>' + pre[i].innerHTML + '<span class="cl"></span>';
          var num = pre[i].innerHTML.split(/\n/).length;
          for (var j = 0; j < (num - 1); j++) {
            var line_num = pre[i].getElementsByTagName('span')[0];
            line_num.innerHTML += '<span>' + (j + 1) + '</span>';
          }
        }
      })();
    </script>
  </body>
</html>
